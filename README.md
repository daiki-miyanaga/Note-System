# 洋生ノート - 入荷数変更＋過去参照 一体型システム v1.2

## 概要

本システムは、洋生菓子の日次売上管理を行うWebアプリケーションです。入荷数の変更と過去実績の参照を同一ページ内で効率的に行えるよう設計されています。

## 主な機能

### 1. 基本機能
- **日次データ管理**: 日別の売上実績・在庫管理
- **自動計算**: 売上個数・売上金額の自動算出
- **データ保存**: LocalStorageによるオフライン保存
- **CSV出力**: 標準フォーマットでのデータエクスポート

### 2. 入荷数変更機能
- **リアルタイム計算**: 入荷数変更時の即座な再計算
- **発注単位チェック**: 商品別発注単位の自動検証
- **バリデーション**: 不正入力の防止とエラー表示

### 3. 過去参照機能（修正モード）
- **行内参照パネル**: 選択行直下での過去データ表示
- **複数プリセット**: 前年同曜日・同日・直近中央値の切り替え
- **D+1/D+2予算入力**: 将来予算の手動入力・自動金額計算

### 4. UI/UX
- **レスポンシブ対応**: タブレット・PC横持ち最適化
- **自動保存**: 30秒間隔の自動保存機能
- **ダーティ状態管理**: 未保存データの視覚的表示

## ファイル構成

```
./
├── yousei-notebook.html      # メインアプリケーション
├── test-yousei-notebook.js   # テストスクリプト
├── 仕様書.md                 # システム仕様書（v1.2）
├── 設計ドキュメント.md        # 設計書（Final）
├── 設計ドキュメント_draft_claude.md  # 設計書（Draft）
└── README.md                 # このファイル
```

## システム要件

### 動作環境
- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **画面解像度**: 横1280px以上推奨
- **デバイス**: タブレット（10-11inch）, PC（15inch）

### 技術仕様
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **データ保存**: LocalStorage
- **ファイル出力**: CSV (UTF-8 BOM付き)

## 使用方法

### 1. 基本操作
1. `yousei-notebook.html` をブラウザで開く
2. ヘッダで対象日・天気・気温・店舗を設定
3. 明細テーブルで各項目を入力
4. 自動計算結果をリアルタイムで確認

### 2. 修正モード（過去参照）
1. ツールバーで「修正モード」をONにする
2. 参照したい商品の行をクリック
3. 行内参照パネルで過去データを確認
4. 必要に応じてD+1/D+2予算を入力

### 3. データ管理
- **保存**: 手動保存ボタンまたは自動保存（30秒間隔）
- **CSV出力**: ツールバーの「CSV出力」ボタン
- **計算**: 「再計算」ボタンで全項目再計算

## データモデル

### 日次データ構造
```json
{
  "header": {
    "date": "2025-09-07",
    "storeId": "KRB01", 
    "weather": "晴れ",
    "temperature": 28
  },
  "details": [
    {
      "id": "3201",
      "code": "3201",
      "name": "カスタードプリン",
      "priceEx": 444,
      "arrival": 20,
      "carryPrev": 5,
      "movement": 0,
      "waste": 0,
      "endStock": 6,
      "soldoutTime": "18:30",
      "salesQty": 19,
      "revenueEx": 8436,
      "reservation": 3,
      "remarks": "",
      "budget_d1": {"qty": 25, "amountEx": 11100},
      "budget_d2": {"qty": 22, "amountEx": 9768}
    }
  ]
}
```

## 計算仕様

### 主要計算式
- **売上個数**: `salesQty = max(0, arrival + carryPrev + movement - endStock - waste)`
- **売上金額(税抜)**: `revenueEx = salesQty * priceEx`
- **予算金額**: `budgetAmountEx = budgetQty * priceEx`

### 完売警告条件
- `endStock = 0` かつ `soldoutTime` に入力がある場合

### バリデーション
- **入荷数**: 商品の発注単位（orderUnit）の倍数であること
- **数量**: 0以上の整数
- **完売時間**: 10分刻み（00/10/20/30/40/50）

## CSV出力フォーマット

```csv
# 洋生ノート - 2025-09-07 (日曜日)
# 天気: 晴れ, 気温: 28℃
# D+1予算 合計：300個 / ¥150,000
# D+2予算 合計：280個 / ¥140,000

商品C,商品名,単価(税抜),入荷,前日持越し,店間移動(±),ロス,閉店時在庫,完売時間,売上個数,売上金額(税抜),予約数,備考,D+1予算(個),D+1予算金額(税抜),D+2予算(個),D+2予算金額(税抜)
3201,"カスタードプリン",444,20,5,0,0,6,"18:30",19,8436,3,"",25,11100,22,9768
```

## テスト方法

### ブラウザコンソールでのテスト
```javascript
// メインアプリのテスト
testYouseiNotebook();

// バリデーション機能のテスト
testValidation();
```

### 手動テスト項目
1. **データ入力**: 各フィールドの入力・計算確認
2. **修正モード**: 行選択・参照パネル表示
3. **バリデーション**: 発注単位エラーの表示
4. **保存機能**: LocalStorage保存・読み込み
5. **CSV出力**: ファイルダウンロード・内容確認

## トラブルシューティング

### よくある問題
1. **データが保存されない**
   - ブラウザのLocalStorage容量確認
   - プライベートブラウジングモードの場合は通常モードに切り替え

2. **計算結果がおかしい**
   - 「再計算」ボタンを押して再計算実行
   - ブラウザコンソールでエラーログ確認

3. **CSV出力できない**
   - ブラウザの「ダウンロードをブロック」設定確認
   - ポップアップブロッカーの無効化

### デバッグ情報
- ブラウザコンソールに詳細ログ出力
- `window.youseiApp` でアプリケーション状態確認可能

## 今後の拡張予定

### フェーズ2（Google Apps Script同期）
- クラウド保存機能
- 複数店舗データ同期
- 過去データAPI化

### フェーズ3（高度な予測機能）
- 天候係数の自動学習
- 需要予測アルゴリズム
- 期限管理の自動化

## ライセンス

本システムは内部利用目的で開発されており、商用利用には制限があります。

## 作成者

- 設計・開発: Claude Code
- 仕様策定: システム企画部門
- レビュー: CodexCLI

## 更新履歴

- **v1.2** (2025-09-07): 初期バージョン完成
  - 基本機能実装
  - 修正モード・過去参照機能
  - CSV出力・自動保存機能
  - バリデーション・エラーハンドリング